import{e as A,r as a}from"./index.CMQ3OGCn.js";import{g as S,I as w}from"./vanilla.C8HErAQ2.js";const x={},P=a.createContext(void 0);function v(t){return a.useContext(P)||S()}const g=t=>typeof t?.then=="function",h=t=>{t.status||(t.status="pending",t.then(o=>{t.status="fulfilled",t.value=o},o=>{t.status="rejected",t.reason=o}))},R=A.use||(t=>{if(t.status==="pending")throw t;if(t.status==="fulfilled")return t.value;throw t.status==="rejected"?t.reason:(h(t),t)}),b=new WeakMap,_=(t,o)=>{let u=b.get(t);return u||(u=new Promise((r,n)=>{let l=t;const f=e=>s=>{l===e&&r(s)},d=e=>s=>{l===e&&n(s)},c=()=>{try{const e=o();g(e)?(b.set(e,u),l=e,e.then(f(e),d(e)),w(e,c)):r(e)}catch(e){n(e)}};t.then(f(t),d(t)),w(t,c)}),b.set(t,u)),u};function y(t,o){const{delay:u,unstable_promiseStatus:r=!A.use}={},n=v(),[[l,f,d],c]=a.useReducer(s=>{const i=n.get(t);return Object.is(s[0],i)&&s[1]===n&&s[2]===t?s:[i,n,t]},void 0,()=>[n.get(t),n,t]);let e=l;if((f!==n||d!==t)&&(c(),e=n.get(t)),a.useEffect(()=>{const s=n.sub(t,()=>{if(r)try{const i=n.get(t);g(i)&&h(_(i,()=>n.get(t)))}catch{}if(typeof u=="number"){setTimeout(c,u);return}c()});return c(),s},[n,t,u,r]),a.useDebugValue(e),g(e)){const s=_(e,()=>n.get(t));return r&&h(s),R(s)}return e}function C(t,o){const u=v();return a.useCallback((...n)=>{if((x?"production":void 0)!=="production"&&!("write"in t))throw new Error("not writable atom");return u.set(t,...n)},[u,t])}function V(t,o){return[y(t),C(t)]}export{V as a,C as b,y as u};
